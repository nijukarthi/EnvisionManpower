<div class="card">
    <div class="flex items-baseline-last justify-between">
        <h5>Training</h5>
        <p-button label="Clear" icon="pi pi-filter-slash" (onClick)="dt.clear()" />
    </div>
    <div class="border border-[var(--p-content-border-color)] rounded-lg overflow-hidden">
        <p-table
            #dt
            [value]="trainingList"
            showGridlines
            [rowHover]="true"
            [paginator]="true"
            [rows]="pageSize"
            [lazy]="true"
            stripedRows
            [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[10, 20, 30]"
            [totalRecords]="trainingListLength"
            [first]="first"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            editMode="row"
            dataKey="candidateId"
            [tableStyle]="{'min-width': '130rem'}"
            (onPage)="pageChange($event)"
            (onLazyLoad)="loadTraining($event)"
        >
            <ng-template #header>
                <tr>
                    <th rowspan="2">SL No</th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Employee Code</span>
                            <p-columnFilter type="text" field="employeeCode" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Temp EMP Code</span>
                            <p-columnFilter type="text" field="tempEMPCode" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Employee Name</span>
                            <p-columnFilter type="text" field="candidateName" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Project Code</span>
                            <p-columnFilter type="text" field="projectCode" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">Site Name</th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Cluster Name</span>
                            <p-columnFilter type="text" field="clusterName" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Role</span>
                            <p-columnFilter type="text" field="envisionRoleName" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Contact Number</span>
                            <p-columnFilter type="text" field="phoneNumber" display="menu" />
                        </div>
                    </th>
                    <th rowspan="2">
                        <div class="flex items-center justify-between">
                            <span>Joining Date</span>
                            <p-columnFilter type="date" field="date" display="menu" matchMode="between" [showOperator]="false">
                                <ng-template #filter let-filter="filterCallback" let-value>
                                    <div class="flex flex-col gap-2">
                                        <p-datepicker [ngModel]="value?.[0] || null" (ngModelChange)="updateRange($event, value, 0, filter)" placeholder="From Date" />
                                        <p-datepicker [ngModel]="value?.[1] || null" (ngModelChange)="updateRange($event, value, 1, filter)" placeholder="To Date" />
                                    </div>
                                </ng-template>
                            </p-columnFilter>
                        </div>
                    </th>
                    <th colspan="4" style="text-align: center">GWO</th>
                    <th rowspan="2" style="text-align: center">Actions</th>
                </tr>
                <tr>
                    <th>
                        <div class="flex items-center justify-between">
                            <span>Training Status</span>
                            <p-columnFilter field="status" matchMode="equals" display="menu">
                                <ng-template #filter let-value let-filter="filterCallback">
                                    <p-select [options]="trainingStatusList" optionLabel="label" optionValue="value" (onChange)="filter($event.value)" placeholder="Select Statuses" class="w-full"> </p-select>
                                </ng-template>
                            </p-columnFilter>
                        </div>
                    </th>
                    <th>
                        <div class="flex items-center justify-between">
                            <span>Winda Id</span>
                            <p-columnFilter type="text" field="winda" display="menu" />
                        </div>
                    </th>
                    <th>
                        <div class="flex items-center justify-between">
                            <span>Valid From</span>
                            <p-columnFilter type="date" field="validFrom" display="menu" matchMode="between" [showOperator]="false">
                                <ng-template #filter let-filter="filterCallback" let-value>
                                    <div class="flex flex-col gap-2">
                                        <p-datepicker [ngModel]="value?.[0] || null" (ngModelChange)="updateRange($event, value, 0, filter)" placeholder="From Date" />
                                        <p-datepicker [ngModel]="value?.[1] || null" (ngModelChange)="updateRange($event, value, 1, filter)" placeholder="To Date" />
                                    </div>
                                </ng-template>
                            </p-columnFilter>
                        </div>
                    </th>
                    <th>
                        <div class="flex items-center justify-between">
                            <span>Valid Till</span>
                            <p-columnFilter type="date" field="validTill" display="menu" matchMode="between" [showOperator]="false">
                                <ng-template #filter let-filter="filterCallback" let-value>
                                    <div class="flex flex-col gap-2">
                                        <p-datepicker [ngModel]="value?.[0] || null" (ngModelChange)="updateRange($event, value, 0, filter)" placeholder="From Date" />
                                        <p-datepicker [ngModel]="value?.[1] || null" (ngModelChange)="updateRange($event, value, 1, filter)" placeholder="To Date" />
                                    </div>
                                </ng-template>
                            </p-columnFilter>
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template #body let-training let-editing="editing" let-i="rowIndex">
                <tr [pEditableRow]="training">
                    <td>{{ i + 1 }}</td>
                    <td>{{ training.employeeCode || '-' }}</td>
                    <td>{{ training.candidateCode || '-' }}</td>
                    <td>{{ training.candidateName }}</td>
                    <td>{{ training.employmentDetails.project.projectCode }}</td>
                    <td>{{ training.employmentDetails.project.siteName ?? '-' }}</td>
                    <td>{{ training.employmentDetails.cluster.clusterName }}</td>
                    <td>{{ training.employmentDetails.envisionRole.roleName || '-' }}</td>
                    <td>{{ training.phoneNumber || '-' }}</td>
                    <td>{{ training.employmentDetails.joiningDate || '-' }}</td>
                    <td #pEditableColumn>
                        <p-cellEditor>
                            <ng-template #input>
                                <p-select [options]="trainingStatusList" [(ngModel)]="training.gwoTraining.trainingStatus" optionLabel="label" optionValue="value" id="training-status" placeholder="Select Status" [showClear]="true" appendTo="body" />
                            </ng-template>
                            <ng-template #output> {{ getTrainingStatus(training?.gwoTraining?.trainingStatus) }} </ng-template>
                        </p-cellEditor>
                    </td>
                    <td #pEditableColumn>
                        <p-cellEditor>
                            <ng-template #input>
                                <input type="text" pInputText [(ngModel)]="training.gwoTraining.windaId" />
                            </ng-template>
                            <ng-template #output> {{ training?.gwoTraining?.windaId || '-' }} </ng-template>
                        </p-cellEditor>
                    </td>
                    <td #pEditableColumn>
                        <p-cellEditor>
                            <ng-template #input>
                                <p-datepicker [(ngModel)]="training.gwoTraining.validFrom" [iconDisplay]="'input'" [showIcon]="true" placeholder="Select Date" appendTo="body" />
                            </ng-template>
                            <ng-template #output> {{ training?.gwoTraining?.validFrom || '-' }} </ng-template>
                        </p-cellEditor>
                    </td>
                    <td #pEditableColumn>
                        <p-cellEditor>
                            <ng-template #input>
                                <p-datepicker [(ngModel)]="training.gwoTraining.validTill" [iconDisplay]="'input'" [showIcon]="true" placeholder="Select Date" appendTo="body" />
                            </ng-template>
                            <ng-template #output> {{ training?.gwoTraining?.validTill || '-' }} </ng-template>
                        </p-cellEditor>
                    </td>
                    <td class="flex items-center justify-center gap-2">
                        @if (!editing) {
                        <button pButton pRipple type="button" icon="pi pi-pencil" pInitEditableRow rounded severity="secondary"></button>

                        } @else {
                        <button pButton pRipple type="submit" icon="pi pi-check" pSaveEditableRow rounded severity="primary" (click)="submitTrainingForm(training)"></button>
                        <button pButton pRipple type="button" icon="pi pi-times" pCancelEditableRow rounded severity="danger"></button>
                        }
                    </td>
                </tr>
            </ng-template>
            <ng-template #emptymessage>
                <tr>
                    <td colspan="100%" style="text-align: center; padding: 1rem 0; background-color: var(--surface-ground)">No Records Found</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
